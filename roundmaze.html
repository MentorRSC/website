<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIGNAMIO — Round Maze | Innovation Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #1a73e8;
            --secondary: #34a853;
            --accent: #fbbc04;
            --dark: #202124;
            --light: #f8f9fa;
            --text: #5f6368;
            --white: #ffffff;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --danger: #e74c3c;
            --purple: #9b59b6;
            --teal: #1abc9c;
        }

        body {
            background: linear-gradient(135deg, #1a2a3a 0%, #0d1b2a 100%);
            color: var(--white);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header Styles */
        header {
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .logo i {
            font-size: 32px;
            color: var(--accent);
            margin-right: 10px;
        }

        .logo h1 {
            font-size: 24px;
            color: var(--white);
        }

        .logo span {
            color: var(--accent);
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 25px;
        }

        nav ul li a {
            text-decoration: none;
            color: var(--white);
            font-weight: 500;
            transition: color 0.3s;
            opacity: 0.8;
        }

        nav ul li a:hover, nav ul li a.active {
            color: var(--accent);
            opacity: 1;
        }

        .cta-button {
            background-color: var(--accent);
            color: var(--dark);
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }

        .cta-button:hover {
            background-color: #e6a800;
            transform: translateY(-2px);
        }

        .mobile-menu {
            display: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--white);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px 0;
        }

        /* Game Container */
        .game-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .game-header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .game-header p {
            font-size: 1.2rem;
            opacity: 0.8;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Game Controls */
        .game-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .control-group label {
            font-weight: 500;
            opacity: 0.9;
        }

        .control-group select {
            padding: 10px 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: var(--white);
            font-size: 1rem;
            cursor: pointer;
        }

        /* Button Styles */
        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            display: inline-block;
            text-align: center;
            font-size: 1rem;
        }

        .btn-start {
            background: linear-gradient(135deg, var(--secondary), #2d9c4d);
            color: var(--white);
        }

        .btn-start:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(52, 168, 83, 0.4);
        }

        .btn-reset {
            background: linear-gradient(135deg, var(--danger), #c0392b);
            color: var(--white);
        }

        .btn-reset:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .btn-blue {
            background: linear-gradient(135deg, var(--primary), #0d5bbb);
            color: var(--white);
        }

        .btn-blue:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(26, 115, 232, 0.4);
        }

        /* Game Stats */
        .game-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .stat:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .ball-1 .stat-value { color: #e74c3c; }
        .ball-2 .stat-value { color: #3498db; }
        .ball-3 .stat-value { color: #9b59b6; }

        /* Maze Container */
        .maze-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            aspect-ratio: 1 / 1;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            border: 3px solid rgba(255, 255, 255, 0.1);
        }

        #maze-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        /* Game Instructions */
        .game-instructions {
            margin-top: 30px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border-left: 4px solid var(--accent);
        }

        .game-instructions h3 {
            margin-bottom: 15px;
            color: var(--accent);
            font-size: 1.5rem;
        }

        .game-instructions p {
            margin-bottom: 15px;
            opacity: 0.9;
            line-height: 1.7;
        }

        .tilt-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .tilt-controls i {
            font-size: 28px;
            color: var(--accent);
        }

        .tilt-controls span {
            font-weight: 500;
        }

        /* Ball Status */
        .ball-status {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .ball-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ball-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        .ball-1-color { background: #e74c3c; }
        .ball-2-color { background: #3498db; }
        .ball-3-color { background: #9b59b6; }

        /* Footer */
        footer {
            background-color: rgba(0, 0, 0, 0.3);
            color: var(--white);
            padding: 40px 0 20px;
            margin-top: auto;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-column h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            position: relative;
            padding-bottom: 10px;
            color: var(--accent);
        }

        .footer-column h3:after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 40px;
            height: 3px;
            background-color: var(--accent);
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 10px;
        }

        .footer-column ul li a {
            color: #bbb;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-column ul li a:hover {
            color: var(--accent);
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: var(--white);
            transition: background-color 0.3s;
            text-decoration: none;
        }

        .social-links a:hover {
            background-color: var(--accent);
            transform: translateY(-3px);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #bbb;
            font-size: 0.9rem;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                text-align: center;
            }

            nav ul {
                margin-top: 20px;
                flex-wrap: wrap;
                justify-content: center;
            }

            nav ul li {
                margin: 5px 10px;
            }

            .mobile-menu {
                display: block;
                position: absolute;
                top: 20px;
                right: 20px;
            }

            .nav-menu {
                display: none;
                width: 100%;
            }

            .nav-menu.active {
                display: block;
            }

            .game-header h1 {
                font-size: 2.2rem;
            }

            .game-controls {
                flex-direction: column;
                align-items: center;
            }

            .game-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .maze-container {
                max-width: 400px;
            }
        }

        @media (max-width: 480px) {
            .game-stats {
                grid-template-columns: 1fr;
            }
            
            .maze-container {
                max-width: 320px;
            }
            
            .stat {
                padding: 15px;
            }
        }

        /* Game Over Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #1a2a3a 0%, #0d1b2a 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal h2 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 2.5rem;
        }

        .modal p {
            margin-bottom: 25px;
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .completion-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 25px 0;
        }

        .completion-stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
        }

        .completion-stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .completion-stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="container header-container">
            <a href="index.html" class="logo">
                <i class="fas fa-compass"></i>
                <h1>SIGNAMIO<span>Maze</span></h1>
            </a>
            <div class="mobile-menu">
                <i class="fas fa-bars"></i>
            </div>
            <nav class="nav-menu">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="puzzles.html">Puzzles</a></li>
                    <li><a href="hanoi.html">Tower of Hanoi</a></li>
                    <li><a href="maze.html" class="active">Round Maze</a></li>
                    <li><a href="https://rscpcalicut.org.in/">Innovation Hub</a></li>
                    <li><a href="https://docs.google.com/forms/d/e/1FAIpQLSev3gYFPXHilQ4mj8lDwT_a7tHSGJmdhbSqok0Y4kVqM1yl1w/viewform?usp=dialog" class="cta-button">Join Now</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Game Section -->
            <section class="game-container">
                <div class="game-header">
                    <h1>SIGNAMIO — Round Maze</h1>
                    <p>Navigate multiple balls through the circular maze and guide them all to the center. Tilt your device to control the balls!</p>
                </div>
                
                <div class="maze-game">
                    <div class="game-controls">
                        <div class="control-group">
                            <label for="ball-count">Balls:</label>
                            <select id="ball-count">
                                <option value="1">1 Ball</option>
                                <option value="2" selected>2 Balls</option>
                                <option value="3">3 Balls</option>
                            </select>
                            
                            <label for="maze-level">Difficulty:</label>
                            <select id="maze-level">
                                <option value="1">Easy</option>
                                <option value="2" selected>Medium</option>
                                <option value="3">Hard</option>
                            </select>
                        </div>
                        
                        <div class="control-group">
                            <button id="start-maze-btn" class="btn btn-start">Start Game</button>
                            <button id="reset-maze-btn" class="btn btn-reset">Reset</button>
                        </div>
                    </div>
                    
                    <div class="game-stats">
                        <div class="stat">
                            <div class="stat-value" id="time-taken">00:00</div>
                            <div class="stat-label">Time</div>
                        </div>
                        <div class="stat ball-1">
                            <div class="stat-value" id="ball-1-status">❌</div>
                            <div class="stat-label">Ball 1</div>
                        </div>
                        <div class="stat ball-2">
                            <div class="stat-value" id="ball-2-status">❌</div>
                            <div class="stat-label">Ball 2</div>
                        </div>
                        <div class="stat ball-3">
                            <div class="stat-value" id="ball-3-status">❌</div>
                            <div class="stat-label">Ball 3</div>
                        </div>
                    </div>
                    
                    <div class="maze-container">
                        <canvas id="maze-canvas"></canvas>
                    </div>
                    
                    <div class="ball-status">
                        <div class="ball-indicator">
                            <div class="ball-color ball-1-color"></div>
                            <span>Ball 1 - Not in Center</span>
                        </div>
                        <div class="ball-indicator">
                            <div class="ball-color ball-2-color"></div>
                            <span>Ball 2 - Not in Center</span>
                        </div>
                        <div class="ball-indicator">
                            <div class="ball-color ball-3-color"></div>
                            <span>Ball 3 - Not in Center</span>
                        </div>
                    </div>
                    
                    <div class="game-instructions">
                        <h3>How to Play SIGNAMIO</h3>
                        <p>Tilt your mobile device to roll the balls through the circular maze. Guide all active balls to the center goal area to complete the level. The balls cannot leave the maze boundaries.</p>
                        <p><strong>Objective:</strong> Get all balls to the center of the maze as quickly as possible!</p>
                        <div class="tilt-controls">
                            <i class="fas fa-mobile-alt"></i>
                            <span>Tilt your device to control the balls</span>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Game Over Modal -->
    <div id="game-over-modal" class="modal">
        <div class="modal-content">
            <h2>Level Complete!</h2>
            <p id="completion-message">You guided all balls to the center!</p>
            
            <div class="completion-stats">
                <div class="completion-stat">
                    <div class="completion-stat-value" id="completion-time">00:00</div>
                    <div class="completion-stat-label">Time</div>
                </div>
                <div class="completion-stat">
                    <div class="completion-stat-value" id="completion-balls">0/0</div>
                    <div class="completion-stat-label">Balls</div>
                </div>
                <div class="completion-stat">
                    <div class="completion-stat-value" id="completion-level">Medium</div>
                    <div class="completion-stat-label">Difficulty</div>
                </div>
            </div>
            
            <div class="modal-buttons">
                <button id="next-level-btn" class="btn btn-start">Next Level</button>
                <button id="play-again-btn" class="btn btn-blue">Play Again</button>
                <button id="close-modal-btn" class="btn btn-reset">Close</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>SIGNAMIO <span>Maze</span></h3>
                    <p>A challenging circular maze game that tests your coordination and spatial reasoning skills. Part of the Innovation Hub puzzle collection.</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="footer-column">
                    <h3>Game Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="puzzles.html">All Puzzles</a></li>
                        <li><a href="hanoi.html">Tower of Hanoi</a></li>
                        <li><a href="maze.html">Round Maze</a></li>
                        <li><a href="https://rscpcalicut.org.in/">Innovation Hub</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Game Features</h3>
                    <ul>
                        <li><a href="#">1-3 Ball Modes</a></li>
                        <li><a href="#">Multiple Difficulty Levels</a></li>
                        <li><a href="#">Tilt Controls</a></li>
                        <li><a href="#">Time Tracking</a></li>
                        <li><a href="#">Progress Saving</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Contact</h3>
                    <ul>
                        <li><i class="fas fa-map-marker-alt"></i> Innovation Hub, Calicut</li>
                        <li><i class="fas fa-phone"></i> 0495 2770571</li>
                        <li><i class="fas fa-envelope"></i> mentor2hubrsc@gmail.com</li>
                        <li><i class="fas fa-clock"></i> TUESDAY - SUNDAY: 11AM-4PM</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Regional Science Centre and Planetarium, Calicut. SIGNAMIO Maze Game.</p>
            </div>
        </div>
    </footer>

    <script>
        // Mobile menu toggle
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenu = document.querySelector('.mobile-menu');
            const navMenu = document.querySelector('.nav-menu');
            
            mobileMenu.addEventListener('click', function() {
                navMenu.classList.toggle('active');
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', function(event) {
                if (!event.target.closest('.header-container')) {
                    navMenu.classList.remove('active');
                }
            });

            // SIGNAMIO Round Maze Game
            const canvas = document.getElementById('maze-canvas');
            const ctx = canvas.getContext('2d');
            const ballCountSelect = document.getElementById('ball-count');
            const mazeLevelSelect = document.getElementById('maze-level');
            const startMazeBtn = document.getElementById('start-maze-btn');
            const resetMazeBtn = document.getElementById('reset-maze-btn');
            const timeTakenElement = document.getElementById('time-taken');
            const ball1StatusElement = document.getElementById('ball-1-status');
            const ball2StatusElement = document.getElementById('ball-2-status');
            const ball3StatusElement = document.getElementById('ball-3-status');
            const gameOverModal = document.getElementById('game-over-modal');
            const completionTimeElement = document.getElementById('completion-time');
            const completionBallsElement = document.getElementById('completion-balls');
            const completionLevelElement = document.getElementById('completion-level');
            const completionMessageElement = document.getElementById('completion-message');
            const nextLevelBtn = document.getElementById('next-level-btn');
            const playAgainBtn = document.getElementById('play-again-btn');
            const closeModalBtn = document.getElementById('close-modal-btn');

            // Game variables
            let gameActive = false;
            let balls = [];
            let goal = { x: 0, y: 0, radius: 30, color: '#2ecc71' };
            let walls = [];
            let startTime = null;
            let timerInterval = null;
            let currentLevel = 2;
            let ballCount = 2;
            let deviceOrientation = { alpha: 0, beta: 0, gamma: 0 };
            let canvasSize = 0;
            let mazeRadius = 0;
            let completedBalls = 0;

            // Ball colors
            const ballColors = ['#e74c3c', '#3498db', '#9b59b6'];

            // Initialize the game
            function initMazeGame() {
                // Set canvas size
                resizeCanvas();
                
                // Set game parameters
                currentLevel = parseInt(mazeLevelSelect.value);
                ballCount = parseInt(ballCountSelect.value);
                
                // Generate maze based on level
                generateMaze(currentLevel);
                
                // Create balls
                createBalls();
                
                // Reset game state
                resetGameState();
                
                // Start game
                gameActive = true;
                
                // Start game loop
                requestAnimationFrame(gameLoop);
                
                // Request device orientation permission
                if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission()
                        .then(permissionState => {
                            if (permissionState === 'granted') {
                                window.addEventListener('deviceorientation', handleDeviceOrientation);
                            }
                        })
                        .catch(console.error);
                } else {
                    window.addEventListener('deviceorientation', handleDeviceOrientation);
                }
            }

            // Resize canvas to fit container
            function resizeCanvas() {
                const container = canvas.parentElement;
                canvasSize = Math.min(container.clientWidth, container.clientHeight);
                canvas.width = canvasSize;
                canvas.height = canvasSize;
                mazeRadius = canvasSize / 2 - 50;
                goal.x = canvasSize / 2;
                goal.y = canvasSize / 2;
            }

            // Generate maze based on level
            function generateMaze(level) {
                walls = [];
                const centerX = canvasSize / 2;
                const centerY = canvasSize / 2;
                
                // Outer boundary (prevents balls from leaving maze)
                walls.push({ type: 'circle', x: centerX, y: centerY, radius: mazeRadius, thickness: 5 });
                
                if (level === 1) {
                    // Easy level - simple circular path
                    walls.push({ type: 'circle', x: centerX, y: centerY, radius: mazeRadius * 0.7, thickness: 8 });
                    walls.push({ type: 'circle', x: centerX, y: centerY, radius: mazeRadius * 0.4, thickness: 8 });
                    
                    // Add some obstacles
                    walls.push({ type: 'line', x1: centerX, y1: centerY - mazeRadius * 0.5, x2: centerX, y2: centerY + mazeRadius * 0.5, thickness: 6 });
                    
                } else if (level === 2) {
                    // Medium level - more complex path
                    walls.push({ type: 'circle', x: centerX, y: centerY, radius: mazeRadius * 0.8, thickness: 8 });
                    walls.push({ type: 'circle', x: centerX, y: centerY, radius: mazeRadius * 0.5, thickness: 8 });
                    walls.push({ type: 'circle', x: centerX, y: centerY, radius: mazeRadius * 0.2, thickness: 8 });
                    
                    // Add obstacles
                    for (let i = 0; i < 4; i++) {
                        const angle = (i * Math.PI) / 2;
                        const length = mazeRadius * 0.7;
                        walls.push({
                            type: 'line',
                            x1: centerX + Math.cos(angle) * mazeRadius * 0.3,
                            y1: centerY + Math.sin(angle) * mazeRadius * 0.3,
                            x2: centerX + Math.cos(angle) * length,
                            y2: centerY + Math.sin(angle) * length,
                            thickness: 6
                        });
                    }
                    
                } else {
                    // Hard level - complex maze
                    walls.push({ type: 'circle', x: centerX, y: centerY, radius: mazeRadius * 0.85, thickness: 8 });
                    walls.push({ type: 'circle', x: centerX, y: centerY, radius: mazeRadius * 0.65, thickness: 8 });
                    walls.push({ type: 'circle', x: centerX, y: centerY, radius: mazeRadius * 0.45, thickness: 8 });
                    walls.push({ type: 'circle', x: centerX, y: centerY, radius: mazeRadius * 0.25, thickness: 8 });
                    
                    // Add multiple obstacles
                    for (let i = 0; i < 8; i++) {
                        const angle = (i * Math.PI) / 4;
                        const length = mazeRadius * 0.8;
                        walls.push({
                            type: 'line',
                            x1: centerX + Math.cos(angle) * mazeRadius * 0.2,
                            y1: centerY + Math.sin(angle) * mazeRadius * 0.2,
                            x2: centerX + Math.cos(angle) * length,
                            y2: centerY + Math.sin(angle) * length,
                            thickness: 5
                        });
                    }
                }
            }

            // Create balls based on selected count
            function createBalls() {
                balls = [];
                const centerX = canvasSize / 2;
                const centerY = canvasSize / 2;
                
                // Position balls at different starting points around the maze
                for (let i = 0; i < ballCount; i++) {
                    const angle = (i * 2 * Math.PI) / ballCount;
                    const distance = mazeRadius * 0.8;
                    
                    balls.push({
                        x: centerX + Math.cos(angle) * distance,
                        y: centerY + Math.sin(angle) * distance,
                        radius: 15,
                        color: ballColors[i],
                        completed: false,
                        id: i
                    });
                }
                
                // Update ball status display
                updateBallStatusDisplay();
            }

            // Reset game state
            function resetGameState() {
                completedBalls = 0;
                startTime = new Date();
                clearInterval(timerInterval);
                
                timerInterval = setInterval(() => {
                    const currentTime = new Date();
                    const elapsedTime = Math.floor((currentTime - startTime) / 1000);
                    const minutes = Math.floor(elapsedTime / 60);
                    const seconds = elapsedTime % 60;
                    
                    timeTakenElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
                
                // Reset ball completion status
                balls.forEach(ball => {
                    ball.completed = false;
                });
                
                updateBallStatusDisplay();
            }

            // Update ball status display
            function updateBallStatusDisplay() {
                // Update status indicators
                ball1StatusElement.textContent = balls[0]?.completed ? '✅' : '❌';
                ball2StatusElement.textContent = balls[1]?.completed ? '✅' : '❌';
                ball3StatusElement.textContent = balls[2]?.completed ? '✅' : '❌';
                
                // Update ball status text
                const ballIndicators = document.querySelectorAll('.ball-indicator span');
                balls.forEach((ball, index) => {
                    if (ballIndicators[index]) {
                        ballIndicators[index].textContent = `Ball ${index + 1} - ${ball.completed ? 'In Center' : 'Not in Center'}`;
                    }
                });
            }

            // Handle device orientation
            function handleDeviceOrientation(event) {
                if (!gameActive) return;
                
                deviceOrientation = {
                    alpha: event.alpha || 0,
                    beta: event.beta || 0,
                    gamma: event.gamma || 0
                };
            }

            // Game loop
            function gameLoop() {
                if (!gameActive) return;
                
                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Draw maze background
                drawMazeBackground();
                
                // Draw maze walls
                drawMaze();
                
                // Update ball positions based on device orientation
                updateBallPositions();
                
                // Draw goal
                drawGoal();
                
                // Draw balls
                drawBalls();
                
                // Check for win condition
                checkWinCondition();
                
                // Continue game loop
                requestAnimationFrame(gameLoop);
            }

            // Draw the maze background
            function drawMazeBackground() {
                const centerX = canvasSize / 2;
                const centerY = canvasSize / 2;
                
                // Draw outer circle
                ctx.beginPath();
                ctx.arc(centerX, centerY, mazeRadius, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(30, 40, 60, 0.8)';
                ctx.fill();
                
                // Draw concentric circles
                for (let i = 1; i <= 5; i++) {
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, mazeRadius * (i / 5), 0, Math.PI * 2);
                    ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                }
            }

            // Draw the maze walls
            function drawMaze() {
                ctx.strokeStyle = '#3498db';
                ctx.lineWidth = 1;
                
                walls.forEach(wall => {
                    ctx.beginPath();
                    if (wall.type === 'circle') {
                        ctx.arc(wall.x, wall.y, wall.radius, 0, Math.PI * 2);
                        ctx.lineWidth = wall.thickness;
                        ctx.strokeStyle = '#2980b9';
                        ctx.stroke();
                        
                        // Add inner glow
                        ctx.beginPath();
                        ctx.arc(wall.x, wall.y, wall.radius, 0, Math.PI * 2);
                        ctx.strokeStyle = 'rgba(52, 152, 219, 0.3)';
                        ctx.lineWidth = wall.thickness + 4;
                        ctx.stroke();
                    } else if (wall.type === 'line') {
                        ctx.lineWidth = wall.thickness;
                        ctx.strokeStyle = '#2980b9';
                        ctx.moveTo(wall.x1, wall.y1);
                        ctx.lineTo(wall.x2, wall.y2);
                        ctx.stroke();
                        
                        // Add inner glow
                        ctx.beginPath();
                        ctx.moveTo(wall.x1, wall.y1);
                        ctx.lineTo(wall.x2, wall.y2);
                        ctx.strokeStyle = 'rgba(52, 152, 219, 0.3)';
                        ctx.lineWidth = wall.thickness + 4;
                        ctx.stroke();
                    }
                });
            }

            // Draw the goal
            function drawGoal() {
                ctx.beginPath();
                ctx.arc(goal.x, goal.y, goal.radius, 0, Math.PI * 2);
                
                // Create gradient
                const gradient = ctx.createRadialGradient(
                    goal.x, goal.y, 0,
                    goal.x, goal.y, goal.radius
                );
                gradient.addColorStop(0, 'rgba(46, 204, 113, 0.9)');
                gradient.addColorStop(1, 'rgba(39, 174, 96, 0.7)');
                
                ctx.fillStyle = gradient;
                ctx.fill();
                
                // Add pulsing effect
                const pulseSize = Math.sin(Date.now() / 300) * 5;
                ctx.beginPath();
                ctx.arc(goal.x, goal.y, goal.radius + pulseSize, 0, Math.PI * 2);
                ctx.strokeStyle = 'rgba(46, 204, 113, 0.5)';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // Add center marker
                ctx.beginPath();
                ctx.arc(goal.x, goal.y, 5, 0, Math.PI * 2);
                ctx.fillStyle = 'white';
                ctx.fill();
            }

            // Draw the balls
            function drawBalls() {
                balls.forEach(ball => {
                    if (ball.completed) return; // Don't draw completed balls
                    
                    ctx.beginPath();
                    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                    
                    // Create gradient for ball
                    const gradient = ctx.createRadialGradient(
                        ball.x - ball.radius/3, ball.y - ball.radius/3, 0,
                        ball.x, ball.y, ball.radius
                    );
                    gradient.addColorStop(0, 'rgba(255, 255, 255, 0.8)');
                    gradient.addColorStop(0.5, ball.color);
                    gradient.addColorStop(1, shadeColor(ball.color, -30));
                    
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    
                    // Add border
                    ctx.strokeStyle = shadeColor(ball.color, -50);
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    // Add shine effect
                    ctx.beginPath();
                    ctx.arc(ball.x - ball.radius/3, ball.y - ball.radius/3, ball.radius/3, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                    ctx.fill();
                    
                    // Add ball number
                    ctx.fillStyle = 'white';
                    ctx.font = 'bold 12px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(ball.id + 1, ball.x, ball.y);
                });
            }

            // Update ball positions based on device orientation
            function updateBallPositions() {
                // Use gamma (left-right tilt) and beta (front-back tilt) for movement
                const sensitivity = 0.7;
                const maxSpeed = 4;
                
                // Calculate movement based on device tilt
                let dx = deviceOrientation.gamma * sensitivity;
                let dy = deviceOrientation.beta * sensitivity;
                
                // Limit speed
                const speed = Math.sqrt(dx * dx + dy * dy);
                if (speed > maxSpeed) {
                    dx = (dx / speed) * maxSpeed;
                    dy = (dy / speed) * maxSpeed;
                }
                
                // Update ball positions and check collisions
                balls.forEach(ball => {
                    if (ball.completed) return; // Don't move completed balls
                    
                    // Store previous position for collision resolution
                    const prevX = ball.x;
                    const prevY = ball.y;
                    
                    // Update ball position
                    ball.x += dx;
                    ball.y += dy;
                    
                    // Check collisions with walls and adjust position
                    checkBallCollisions(ball, prevX, prevY);
                });
            }

            // Check for collisions with walls and adjust ball position
            function checkBallCollisions(ball, prevX, prevY) {
                const centerX = canvasSize / 2;
                const centerY = canvasSize / 2;
                
                // Check distance from center to ensure ball stays within maze
                const dx = ball.x - centerX;
                const dy = ball.y - centerY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                // If ball is trying to leave the maze, push it back in
                if (distance + ball.radius > mazeRadius) {
                    const angle = Math.atan2(dy, dx);
                    ball.x = centerX + Math.cos(angle) * (mazeRadius - ball.radius - 1);
                    ball.y = centerY + Math.sin(angle) * (mazeRadius - ball.radius - 1);
                }
                
                // Check collisions with walls
                walls.forEach(wall => {
                    if (wall.type === 'circle') {
                        // Calculate distance from ball to circle center
                        const dx = ball.x - wall.x;
                        const dy = ball.y - wall.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        // Check if ball is colliding with circle
                        if (distance < wall.radius + ball.radius && distance > wall.radius - wall.thickness - ball.radius) {
                            // Collision detected - push ball away
                            const angle = Math.atan2(dy, dx);
                            const targetX = wall.x + Math.cos(angle) * (wall.radius + ball.radius + 1);
                            const targetY = wall.y + Math.sin(angle) * (wall.radius + ball.radius + 1);
                            
                            ball.x = targetX;
                            ball.y = targetY;
                        }
                    } else if (wall.type === 'line') {
                        // Line collision detection
                        const lineLength = Math.sqrt(
                            Math.pow(wall.x2 - wall.x1, 2) + 
                            Math.pow(wall.y2 - wall.y1, 2)
                        );
                        
                        // Calculate the closest point on the line to the ball
                        const t = Math.max(0, Math.min(1, (
                            (ball.x - wall.x1) * (wall.x2 - wall.x1) + 
                            (ball.y - wall.y1) * (wall.y2 - wall.y1)
                        ) / (lineLength * lineLength)));
                        
                        const closestX = wall.x1 + t * (wall.x2 - wall.x1);
                        const closestY = wall.y1 + t * (wall.y2 - wall.y1);
                        
                        // Calculate distance from ball to closest point on line
                        const distance = Math.sqrt(
                            Math.pow(ball.x - closestX, 2) + 
                            Math.pow(ball.y - closestY, 2)
                        );
                        
                        // Check if ball is colliding with line
                        if (distance < ball.radius + wall.thickness / 2) {
                            // Collision detected - push ball away
                            const angle = Math.atan2(ball.y - closestY, ball.x - closestX);
                            const targetX = closestX + Math.cos(angle) * (ball.radius + wall.thickness / 2 + 1);
                            const targetY = closestY + Math.sin(angle) * (ball.radius + wall.thickness / 2 + 1);
                            
                            ball.x = targetX;
                            ball.y = targetY;
                        }
                    }
                });
            }

            // Check if balls have reached the goal
            function checkWinCondition() {
                let newlyCompleted = 0;
                
                balls.forEach(ball => {
                    if (ball.completed) return; // Skip already completed balls
                    
                    const dx = ball.x - goal.x;
                    const dy = ball.y - goal.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < goal.radius) {
                        ball.completed = true;
                        newlyCompleted++;
                        completedBalls++;
                    }
                });
                
                if (newlyCompleted > 0) {
                    updateBallStatusDisplay();
                    
                    // Check if all balls are completed
                    if (completedBalls === ballCount) {
                        // Level completed!
                        gameActive = false;
                        clearInterval(timerInterval);
                        showGameOverModal(true);
                    }
                }
            }

            // Reset the game
            function resetMazeGame() {
                gameActive = false;
                clearInterval(timerInterval);
                initMazeGame();
            }

            // Show game over modal
            function showGameOverModal(success) {
                if (success) {
                    const currentTime = new Date();
                    const elapsedTime = Math.floor((currentTime - startTime) / 1000);
                    const minutes = Math.floor(elapsedTime / 60);
                    const seconds = elapsedTime % 60;
                    
                    completionTimeElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    completionBallsElement.textContent = `${completedBalls}/${ballCount}`;
                    
                    const levelNames = ['Easy', 'Medium', 'Hard'];
                    completionLevelElement.textContent = levelNames[currentLevel - 1];
                    
                    completionMessageElement.textContent = `You guided all ${ballCount} ball${ballCount > 1 ? 's' : ''} to the center!`;
                    
                    gameOverModal.style.display = 'flex';
                }
            }

            // Utility function to shade colors
            function shadeColor(color, percent) {
                let R = parseInt(color.substring(1, 3), 16);
                let G = parseInt(color.substring(3, 5), 16);
                let B = parseInt(color.substring(5, 7), 16);

                R = parseInt(R * (100 + percent) / 100);
                G = parseInt(G * (100 + percent) / 100);
                B = parseInt(B * (100 + percent) / 100);

                R = (R < 255) ? R : 255;
                G = (G < 255) ? G : 255;
                B = (B < 255) ? B : 255;

                const RR = ((R.toString(16).length == 1) ? "0" + R.toString(16) : R.toString(16));
                const GG = ((G.toString(16).length == 1) ? "0" + G.toString(16) : G.toString(16));
                const BB = ((B.toString(16).length == 1) ? "0" + B.toString(16) : B.toString(16));

                return "#" + RR + GG + BB;
            }

            // Event listeners
            startMazeBtn.addEventListener('click', initMazeGame);
            resetMazeBtn.addEventListener('click', resetMazeGame);
            
            nextLevelBtn.addEventListener('click', function() {
                gameOverModal.style.display = 'none';
                if (currentLevel < 3) {
                    currentLevel++;
                    mazeLevelSelect.value = currentLevel;
                }
                initMazeGame();
            });
            
            playAgainBtn.addEventListener('click', function() {
                gameOverModal.style.display = 'none';
                initMazeGame();
            });
            
            closeModalBtn.addEventListener('click', function() {
                gameOverModal.style.display = 'none';
            });
            
            ballCountSelect.addEventListener('change', function() {
                ballCount = parseInt(this.value);
                if (gameActive) {
                    resetMazeGame();
                }
            });
            
            mazeLevelSelect.addEventListener('change', function() {
                currentLevel = parseInt(this.value);
                if (gameActive) {
                    resetMazeGame();
                }
            });

            // Handle window resize
            window.addEventListener('resize', function() {
                if (gameActive) {
                    resizeCanvas();
                    generateMaze(currentLevel);
                    createBalls();
                }
            });

            // Initialize game on page load
            initMazeGame();
        });
    </script>
</body>
</html>
